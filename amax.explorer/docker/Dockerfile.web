FROM node
ARG CONFIG_NET=production
ENV CONFIG_NET=${CONFIG_NET}

RUN apt update && apt install -y git
RUN git clone https://github.com/armoniax/amax.explorer.git && echo "v0.1"

RUN cd /amax.explorer/frontend && npm install
RUN cd /amax.explorer/frontend && npm run build

FROM nginx
ARG PORT=3039
ENV PORT=${PORT}

RUN rm /etc/nginx/nginx.conf /etc/nginx/conf.d/default.conf
COPY conf /etc/nginx
RUN mkdir -p /opt/www/amax-explorer
COPY --from=0 /amax.explorer/dist/ /opt/www/amax-explorer/
EXPOSE ${PORT}