FROM node:10.15.3

ARG PORT=3039
ENV PORT=${PORT}

ARG CONFIG_NET=production
ENV CONFIG_NET=${CONFIG_NET}

RUN mkdir -p /opt/amaxweb
COPY ./backend/ /opt/amaxweb/
WORKDIR /opt/amaxweb/backend

#RUN npm update
RUN npm install -g pm2@2.10.4 @angular/cli@7.1.4
RUN npm install
RUN npm run build
RUN node patch

CMD ["pm2-runtime", "/opt/amaxweb/server/ecosystem.config.js", "--web"]

EXPOSE ${PORT}
EXPOSE 9615
